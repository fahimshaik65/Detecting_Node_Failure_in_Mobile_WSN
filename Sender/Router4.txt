String Ener=JOptionPane.showInputDialog(null,"Enter Distance");
				
				int dis=Integer.parseInt(Ener);
				Statement st=con.createStatement();
				String cname="NodesInfo";
				String n1="update "+cname+" set dist="+dis+" where node='"+nname+"' ";
				st.executeUpdate(n1);
				
				JOptionPane.showMessageDialog(null,"Distance Updated Successfully");
				
			}catch(Exception es){System.out.println(es);}
			
		}
		if(ae.getSource()==i2)
		{
				try
				{
					ViewRouter r = new ViewRouter();
					r.setSize(700, 400);
					r.setVisible(true);
				
		}catch (Exception e) {
			// TODO: handle exception
		}

	}
		if(ae.getSource()==i3)
		{
			ViewAttackers r = new ViewAttackers();
			r.setSize(750, 400);
			r.setVisible(true);
		}
		
		if(ae.getSource()==i4)
		{
			ViewTimeDelay r1 = new ViewTimeDelay();
			r1.setSize(750, 400);
			r1.setVisible(true);
		}
		if(ae.getSource()==i5)
		{
//			ViewDropped r1 = new ViewDropped();
//			r1.setSize(750, 400);
//			r1.setVisible(true);
		}

	}	
	public static void main(String[] args) throws SQLException
	{
		new Router();
	}

	class PortListener implements Runnable
	{
		int port;

		public PortListener(int port)
		{
			this.port = port;
		}

		public void run()
		{
			Dbcon db = new Dbcon();
			Connection connect=db.getConnection();
			
			if(this.port==4445)
			{
				try
				{
					ServerSocket server909 = new ServerSocket(4445);
					Socket con777;
					while (true) 
					{
					con777 = server909.accept();
					
					DataInputStream dis = new DataInputStream(con777.getInputStream());
					
					String node1	= dis.readUTF();
				
					String attack="Yes";
					SimpleDateFormat dateFormat = new SimpleDateFormat();
				    Date date = new Date();
				       
				    String dt=dateFormat.format(date);
					String energy="";
					
				    if(node1.equalsIgnoreCase("Node9"))
				    {
				    	ResultSet rs=  connect.createStatement().executeQuery("select * from NodesInfo where node='"+node1+"'");
				    	
				    	while(rs.next())
				    	{
				    		energy=rs.getString(4);
				    	}
				    }
				    if(node1.equalsIgnoreCase("Node10"))
				    {
				    	ResultSet rs=  connect.createStatement().executeQuery("select * from NodesInfo where node='"+node1+"'");
				    	
				    	while(rs.next())
				    	{
				    		energy=rs.getString(4);
				    	}
				    }
				    if(node1.equalsIgnoreCase("Node11"))
				    {
				    	ResultSet rs=  connect.createStatement().executeQuery("select * from NodesInfo where node='"+node1+"'");
				    	
				    	while(rs.next())
				    	{
				    		energy=rs.getString(4);
				    	}
				    }
				    if(node1.equalsIgnoreCase("Node12"))
				    {
				    	ResultSet rs=  connect.createStatement().executeQuery("select * from NodesInfo where node='"+node1+"'");
				    	
				    	while(rs.next())
				    	{
				    		energy=rs.getString(4);
				    	}
				    }
				    if(node1.equalsIgnoreCase("Node13"))
				    {
				    	ResultSet rs=  connect.createStatement().executeQuery("select * from NodesInfo where node='"+node1+"'");
				    	
				    	while(rs.next())
				    	{
				    		energy=rs.getString(4);
				    	}
				    }
				    
					DataOutputStream  ds = new DataOutputStream(con777.getOutputStream());
					ds.writeUTF("success");	
					ds.writeUTF(energy);			
					}
					
					}catch (Exception e4) {
						// TODO: handle exception
					}
			}
			if(this.port==8909)
			{
				try
				{
					ServerSocket ss = new ServerSocket(8909);
					
					while (true) 
					{
					cn = ss.accept();
					
					DataInputStream in3=new DataInputStream(cn.getInputStream());
					
					fname=in3.readUTF();
					mac=in3.readUTF();
					ct=in3.readUTF();
					String sp1=in3.readUTF();
					String sp2=in3.readUTF();
					String sp3=in3.readUTF();
					String sp4=in3.readUTF();
					String sp5=in3.readUTF();
					des